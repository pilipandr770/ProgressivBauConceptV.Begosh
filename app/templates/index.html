{% extends "base.html" %}

{% block content %}
<div class="carousel">
    <img id="carousel-image" src="{{ url_for('static', filename='images/luxury1.png') }}" alt="Luxury Renovation">
    <button class="prev" onclick="changeImage(-1)">&#10094;</button>
    <button class="next" onclick="changeImage(1)">&#10095;</button>
</div>

<h2>Ihr Premium-Partner f√ºr Baudienstleistungen in Frankfurt am Main</h2>
<p><strong>ProgressivBauConceptV.Begosh</strong> ‚Äì Exzellenz in Innenausbau, Au√üenarbeiten, Elektrotechnik und Projektmanagement. Seit Jahren vertrauen Kunden aus Frankfurt, Hessen und Umgebung auf unsere handwerkliche Perfektion und individuellen L√∂sungen.</p>

<p>‚úÖ <strong>Besuchen Sie unseren exklusiven Bau-Boutique im Hermitage Frankfurt!</strong></p>
<p>Lassen Sie sich pers√∂nlich beraten und entdecken Sie Ma√ügeschneiderte L√∂sungen f√ºr Ihr Traumobjekt. Unsere Experten nehmen sich Zeit f√ºr Sie ‚Äì vereinbaren Sie noch heute einen unverbindlichen Beratungstermin!</p>

<div class="cta">
    <h3>üìç Besuchen Sie uns im Hermitage Frankfurt</h3>
    <p><strong>Adresse:</strong> Hermitage Shopping Center, Frankfurt am Main</p>
    <a href="/termin-buchen" class="btn">Jetzt Beratungstermin buchen</a>
    <a href="/kontakt" class="btn">Kostenlose R√ºckrufanfrage</a>
</div>

<h2>W√§hlen Sie Ihren Bereich</h2>
<div class="directions">
    <a href="/innenausbau" class="card">
        <img src="{{ url_for('static', filename='images/luxury4.png') }}" alt="Innenausbau" style="width:100%; border-radius:8px;">
        <h3>Innenausbau</h3>
        <p>Professionelle Innenausbauarbeiten</p>
    </a>
    <a href="/aussenarbeiten" class="card">
        <img src="{{ url_for('static', filename='images/aussen1.png') }}" alt="Au√üenarbeiten" style="width:100%; border-radius:8px;">
        <h3>Au√üenarbeiten</h3>
        <p>Qualit√§tsvolle Au√üenarbeiten</p>
    </a>
    <a href="/elektro" class="card">
        <img src="{{ url_for('static', filename='images/electro2.png') }}" alt="Elektro" style="width:100%; border-radius:8px;">
        <h3>Elektro & Smart Home</h3>
        <p>Moderne Elektrotechnik und Smart Home L√∂sungen</p>
    </a>
    <a href="/projektleitung" class="card">
        <img src="{{ url_for('static', filename='images/projekt1.png') }}" alt="Projektleitung" style="width:100%; border-radius:8px;">
        <h3>Projektleitung</h3>
        <p>Kompetente Projektleitung f√ºr Ihr Bauvorhaben</p>
    </a>
</div>

<div class="cta">
    <h2>üèõÔ∏è Besuchen Sie unseren Bau-Boutique im Hermitage Frankfurt</h2>
    <p>Erleben Sie exklusive Beratung auf h√∂chstem Niveau! In unserem Showroom pr√§sentieren wir Ihnen Musterl√∂sungen, hochwertige Materialien und innovative Technologien. Unsere Fachberater entwickeln gemeinsam mit Ihnen das perfekte Konzept f√ºr Ihr Bauprojekt.</p>
    <p><strong>üìç Hermitage Shopping Center, Frankfurt am Main</strong></p>
    <div style="text-align:center; margin:1rem 0;">
        <a href="https://www.google.com/maps/search/Hermitage+Shopping+Center+Frankfurt" target="_blank" style="display:inline-block; padding:1rem 2rem; background:#4285f4; color:white; text-decoration:none; border-radius:8px; font-weight:bold;">
            üìç In Google Maps √∂ffnen
        </a>
    </div>
    <a href="/termin-buchen" class="btn">Jetzt Termin im Bau-Boutique buchen</a>
    <a href="/kontakt" class="btn">Kostenlose Erstberatung anfordern</a>
</div>

<h2>Warum ProgressivBauConceptV.Begosh?</h2>
<ul style="max-width:800px; margin:auto; text-align:left;">
    <li>‚úÖ <strong>15+ Jahre Erfahrung</strong> in Frankfurt und Hessen</li>
    <li>‚úÖ <strong>Pers√∂nliche Beratung</strong> in unserem exklusiven Bau-Boutique</li>
    <li>‚úÖ <strong>T√úV-gepr√ºfte Qualit√§t</strong> und Garantieleistungen</li>
    <li>‚úÖ <strong>Festpreisgarantie</strong> ‚Äì keine versteckten Kosten</li>
    <li>‚úÖ <strong>Alles aus einer Hand</strong> ‚Äì von Planung bis Schl√ºsselfertig</li>
</ul>

<!-- Welcome Chat Widget -->
<div id="welcome-chat-widget">
    <button id="chat-toggle-btn" onclick="toggleWelcomeChat()">
        üí¨
    </button>
    <div id="welcome-chat-window" class="welcome-chat-window">
        <div class="welcome-chat-header">
            <div class="header-content">
                <div class="avatar">üëã</div>
                <div class="header-info">
                    <h3>Lisa</h3>
                    <span class="status">Online ‚Ä¢ Ihre Assistentin</span>
                </div>
            </div>
            <button class="close-chat" onclick="toggleWelcomeChat()">&times;</button>
        </div>
        <div id="welcome-messages">
            <div class="message bot-message">
                <div class="message-content">
                    <strong>Hallo! Willkommen bei ProgressivBauConcept! üëã</strong><br><br>
                    Ich bin Lisa, Ihre pers√∂nliche Assistentin. Wie kann ich Ihnen heute helfen?
                </div>
                <button class="speak-btn" onclick="speakMessage(this)" title="Vorlesen">üîä</button>
            </div>
        </div>
        <div class="welcome-chat-input">
            <button id="voice-btn" class="voice-btn" onclick="toggleVoiceInput()" title="Sprachnachricht">
                üé§
            </button>
            <input type="text" id="welcome-input" placeholder="Ihre Nachricht eingeben...">
            <button id="send-welcome-btn" onclick="sendWelcomeMessage()">
                ‚û§
            </button>
        </div>
    </div>
</div>

<script>
let recognition;
let isRecording = false;
let speechSynthesis = window.speechSynthesis;

// Initialize Speech Recognition
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'de-DE'; // Default to German, will auto-detect
    
    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('welcome-input').value = transcript;
        isRecording = false;
        document.getElementById('voice-btn').innerHTML = 'üé§';
        document.getElementById('voice-btn').classList.remove('recording');
    };
    
    recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        isRecording = false;
        document.getElementById('voice-btn').innerHTML = 'üé§';
        document.getElementById('voice-btn').classList.remove('recording');
    };
    
    recognition.onend = function() {
        isRecording = false;
        document.getElementById('voice-btn').innerHTML = 'üé§';
        document.getElementById('voice-btn').classList.remove('recording');
    };
}

function toggleWelcomeChat() {
    const chatWindow = document.getElementById('welcome-chat-window');
    const toggleBtn = document.getElementById('chat-toggle-btn');
    
    chatWindow.classList.toggle('active');
    
    if (chatWindow.classList.contains('active')) {
        toggleBtn.style.display = 'none';
    } else {
        toggleBtn.style.display = 'flex';
    }
}

function toggleVoiceInput() {
    if (!recognition) {
        alert('Spracherkennung wird in Ihrem Browser nicht unterst√ºtzt.');
        return;
    }
    
    if (isRecording) {
        recognition.stop();
        isRecording = false;
        document.getElementById('voice-btn').innerHTML = 'üé§';
        document.getElementById('voice-btn').classList.remove('recording');
    } else {
        recognition.start();
        isRecording = true;
        document.getElementById('voice-btn').innerHTML = '‚èπÔ∏è';
        document.getElementById('voice-btn').classList.add('recording');
    }
}

function speakMessage(button) {
    const messageContent = button.previousElementSibling.textContent;
    
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        button.innerHTML = 'üîä';
        return;
    }
    
    const utterance = new SpeechSynthesisUtterance(messageContent);
    utterance.lang = 'de-DE';
    utterance.rate = 0.9;
    utterance.pitch = 1;
    
    button.innerHTML = '‚è∏Ô∏è';
    
    utterance.onend = function() {
        button.innerHTML = 'üîä';
    };
    
    speechSynthesis.speak(utterance);
}

function sendWelcomeMessage() {
    const messageInput = document.getElementById('welcome-input');
    const message = messageInput.value.trim();
    
    if (!message) return;
    
    // Display user message
    const messagesDiv = document.getElementById('welcome-messages');
    const userMessageHTML = `
        <div class="message user-message">
            <div class="message-content">${message}</div>
        </div>
    `;
    messagesDiv.insertAdjacentHTML('beforeend', userMessageHTML);
    messageInput.value = '';
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    
    // Show typing indicator
    const typingHTML = `<div class="typing-indicator" id="typing">
        <span></span><span></span><span></span>
    </div>`;
    messagesDiv.insertAdjacentHTML('beforeend', typingHTML);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    
    // Send to backend
    fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: message, agent: 'welcome'})
    })
    .then(response => response.json())
    .then(data => {
        // Remove typing indicator
        const typing = document.getElementById('typing');
        if (typing) typing.remove();
        
        // Add bot message with speak button
        const botMessageHTML = `
            <div class="message bot-message">
                <div class="message-content">${data.response}</div>
                <button class="speak-btn" onclick="speakMessage(this)" title="Vorlesen">üîä</button>
            </div>
        `;
        messagesDiv.insertAdjacentHTML('beforeend', botMessageHTML);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    })
    .catch(error => {
        const typing = document.getElementById('typing');
        if (typing) typing.remove();
        
        const errorHTML = `
            <div class="message bot-message error">
                <div class="message-content">Entschuldigung, ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.</div>
            </div>
        `;
        messagesDiv.insertAdjacentHTML('beforeend', errorHTML);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
}

// Enter key support
document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('welcome-input');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendWelcomeMessage();
            }
        });
    }
    
    // Auto-pulse after 3 seconds
    setTimeout(() => {
        const chatBtn = document.getElementById('chat-toggle-btn');
        if (chatBtn) {
            chatBtn.classList.add('pulse-animation');
        }
    }, 3000);
});
</script>

{% endblock %}